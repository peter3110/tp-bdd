\documentclass[11pt, a4paper]{article}
\usepackage[paper=a4paper, left=1.5cm, right=1.5cm, bottom=1.5cm, top=1.5cm]{geometry}
%
\usepackage[utf8]{inputenc}
\usepackage[spanish]{babel}
\usepackage{ulem}
\usepackage{listings}
\usepackage{xcolor}

\usepackage{caratula/caratula}
\def\doubleunderline#1{\underline{\underline{#1}}}

\colorlet{punct}{red!60!black}
\definecolor{background}{HTML}{EEEEEE}
\definecolor{delim}{RGB}{20,105,176}
\colorlet{numb}{magenta!60!black}
\lstdefinelanguage{json}{
    basicstyle=\normalfont\ttfamily,
    numbers=left,
    numberstyle=\scriptsize,
    stepnumber=1,
    numbersep=8pt,
    showstringspaces=false,
    breaklines=true,
    frame=lines,
    backgroundcolor=\color{background},
    literate=
     *{0}{{{\color{numb}0}}}{1}
      {1}{{{\color{numb}1}}}{1}
      {2}{{{\color{numb}2}}}{1}
      {3}{{{\color{numb}3}}}{1}
      {4}{{{\color{numb}4}}}{1}
      {5}{{{\color{numb}5}}}{1}
      {6}{{{\color{numb}6}}}{1}
      {7}{{{\color{numb}7}}}{1}
      {8}{{{\color{numb}8}}}{1}
      {9}{{{\color{numb}9}}}{1}
      {:}{{{\color{punct}{:}}}}{1}
      {,}{{{\color{punct}{,}}}}{1}
      {\{}{{{\color{delim}{\{}}}}{1}
      {\}}{{{\color{delim}{\}}}}}{1}
      {[}{{{\color{delim}{[}}}}{1}
      {]}{{{\color{delim}{]}}}}{1},
}

\begin{document}

\input{caratula.tex}
%Carátula
\maketitle
\newpage

%Indice
\tableofcontents
\newpage

% Demás secciones
%
\section{Introducción}

\section{Documentos para Mongo}

A continuaci\'on vamos a definir el documento para Mongo en cada una de las queries dadas y argumentar la elecci\'on de dicho documento contando, a alto nivel, como ser\'ian los inserts, mantenimiento y busqueda con map-reduce.

%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Querie 1 + 2}
1. Para mayor nro. de crimenes cometidos por alguna persona \
2. Para nro de crimenes promedio cometidos por criminales \

Para estas primeras dos queries, elegimos diseñar el documento expuesto a continuación: Pensamos que lo más importante es optimizar las búsquedas (ie. los map-reduce).
Para esto, tomamos como clave de cada posible documento el \textbf{dniCulpable} de la persona que fue encontrada culpable de una cantidad \textbf{cantCasosCulpable}) crímenes. \

Inserts: Cada vez que una persona es hallada culpable de un nuevo caso, hay que acceder al documento que le corresponde a ese dni a través de la key \textbf{dniCulpable}, e incrementar su valor \textbf{cantCasosCulpable}. \

Mantenimiento: cada documento ocupa muy poco espacio, con lo cuál es fácilmente mantenible y escalable.\

Map Reduce: Para las queries 1 y 2 el map mapearía todos los values a un mismo key, y el reduce buscaría el máximo y el promedio de dichos valores respectivamente. \

\begin{lstlisting}[language=json]
	[
		{
			dniCulpable: 37206752,
			cantCasosCulpable: 2
		}
	]
\end{lstlisting}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Querie 3}
3. Para 10 ciudades con mayor nro. de crímenes \
Elegimos el diseño expuesto a continuación: para cada ciudad, guardamos su id \textbf{idCiudad} como clave, y como valor una lista \textbf{dniCulpables} con los casos c 
\begin{lstlisting}[language=json]
	[
		{
			idCiudad: 4,
			dniCulpables:
				[
					{dniCulpable: 37206752}, 
					{dniCulpable: 35222345}
				]
		}
	]
\end{lstlisting}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Querie 4}
Cuántas personas se han visto involucradas como testigos en el mayor número de casos
\begin{lstlisting}[language=json]
	[
		{
			dniTestigo: 27893435,
			idCasosInvolucradaComoTestigo:
				[
					{idCaso: 1},
					{idCaso: 4},
					{idCaso: 6}
				]
		}
	]
\end{lstlisting}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Querie 5+6}
5. Para casos con mayor nro. de involucrados
6. Para casos con mayor nro. de evidencia
\begin{lstlisting}[language=json]
   [
   		{
   			idCaso: 4,
	   		{
	   			idEvidencias: 
	   				[	
	   					{idEvidencia: 3},
	   					{idEvidencia: 4}
	   				],
	   			dniInvolucrados:
	   				[
	   					{dniInvolucrado: 37206752}
	   				]
	   		}
	   	}
   ]
\end{lstlisting}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Querie 7}
7. Para cantidad de crimenes de cada tipo cometidos en los ultimos 45 dias
Para optimizar el uso del disco, creamos un documento para cada tipo de crimen. Cada documento tiene como valor un diccionario que para cada fecha de los últimos 45 días, tiene como valor la cantidad de crímenes que se cometieron ese día. \
Mantenimiento: Cada día, hay que recorrer el diccionario correspondiente a cada tipo de crimen, y borrar las entradas correspondientes a fechas de hace más de 45 días. La ventaja de esto, es que sabemos cuánta memoria ocupa cada documento, pues como máximo puede tener 45 fechas. \
Inserts: Buscar en el tipo de crimen correspondiente, buscar en el diccinario la key correspondiente a la fecha, e incrementar el valor. \
Map Reduce: El map recorre el diccionario correspondiente al tipo de crimen a buscar, y mapea sobre una misma clave, la suma de todos los crímenes en las fechas que hay guardadas (todas están incluidas en los últimos 45 días). \
\begin{lstlisting}[language=json]
	[
		{
			idTipoCrimen: 4,
			cantCrimenesPorFecha:
				{
					{fecha: 2014-10-08, cantidadDeCrimenes: 4},
					{fecha: 2015-03-10, cantidadDeCrimenes: 1},
					{fecha: 2016-10-10, cantidadDeCrimenes: 2}
				}
		}
	]
\end{lstlisting}

\section{Conclusiones}

\end{document}
